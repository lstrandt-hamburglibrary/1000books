<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1000 Books Before Kindergarten - Hamburg Township Library</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .app-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .app-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .child-selector {
            margin-top: 10px;
        }

        .child-selector select {
            padding: 8px 15px;
            border-radius: 25px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
            cursor: pointer;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            padding: 10px;
            gap: 10px;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .content {
            padding: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Dashboard Styles */
        .progress-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .progress-circle {
            width: 250px;
            height: 250px;
            margin: 0 auto;
        }

        .progress-text {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
        }

        .progress-label {
            font-size: 1.2rem;
            color: #6c757d;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-emoji {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #495057;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .rating-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .rating-btn {
            padding: 10px 20px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .rating-btn:hover {
            background: #f8f9fa;
        }

        .rating-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .submit-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        /* Library Styles */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .book-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .book-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        .book-author {
            color: #6c757d;
            margin-bottom: 5px;
        }

        .book-date {
            font-size: 0.9rem;
            color: #adb5bd;
        }

        .book-rating {
            margin-top: 10px;
        }

        /* Badges */
        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .badge-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .badge-card.earned {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .badge-card.locked {
            opacity: 0.5;
        }

        .badge-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .badge-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .badge-description {
            font-size: 0.9rem;
        }

        /* Recent Books */
        .recent-books {
            margin-top: 30px;
        }

        .recent-books h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .recent-books-list {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .recent-book {
            min-width: 150px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        /* Update Banner */
        .update-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: center;
            display: none;
            z-index: 9999;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .update-banner.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .update-banner button {
            margin-left: 10px;
            padding: 5px 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .update-banner .update-now {
            background: white;
            color: #667eea;
        }

        .update-banner .update-later {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }
            to {
                transform: translateY(0);
            }
        }

        /* Milestones */
        .milestone-tracker {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .milestone-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .milestone-progress {
            font-size: 1.2rem;
        }

        .next-milestone {
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Games Styles */
        .games-intro {
            text-align: center;
            color: #6c757d;
            margin-bottom: 20px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .game-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .game-card.unlocked {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .game-card.unlocked:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .game-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .game-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .game-requirement {
            font-size: 0.9rem;
        }

        /* Mini Game Styles */
        .mini-game {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .game-header h3 {
            margin: 0;
            color: #495057;
        }

        .game-close-btn {
            background: #dc3545;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .game-instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-score {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #495057;
        }

        .bone-game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .hiding-spot {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            height: 80px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            transition: all 0.3s;
        }

        .hiding-spot:hover {
            transform: scale(1.05);
        }

        .hiding-spot.revealed {
            background: #e9ecef;
            cursor: not-allowed;
        }

        .hiding-spot.found {
            background: #28a745;
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .game-reset-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
        }

        .game-reset-btn:hover {
            background: #764ba2;
        }

        .game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        /* Suggestions Styles */
        .suggestion-lists {
            margin-top: 20px;
        }

        .suggestion-category {
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .suggestion-category-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            transition: all 0.3s;
        }

        .suggestion-category-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        }

        .suggestion-category-header h3 {
            color: #495057;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expand-icon {
            font-size: 1.2rem;
            transition: transform 0.3s;
            color: #6c757d;
        }

        .suggestion-category.collapsed .expand-icon {
            transform: rotate(-90deg);
        }

        .suggestion-category-content {
            padding: 0 20px 20px 20px;
            max-height: 1000px;
            opacity: 1;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
        }

        .suggestion-category.collapsed .suggestion-category-content {
            max-height: 0;
            opacity: 0;
            padding: 0 20px;
            overflow: hidden;
        }

        .suggestion-books {
            display: grid;
            gap: 10px;
        }

        .suggestion-book {
            background: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .suggestion-book:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .suggestion-book-info {
            flex: 1;
        }

        .suggestion-book-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        .suggestion-book-author {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .suggestion-book-age {
            color: #adb5bd;
            font-size: 0.85rem;
            margin-top: 3px;
        }

        .add-suggestion-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .add-suggestion-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .add-suggestion-btn.added {
            background: #28a745;
            cursor: default;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body>
    <!-- Update Banner -->
    <div class="update-banner" id="updateBanner">
        <span>üì£ New version available with bug fixes and improvements!</span>
        <button class="update-now" onclick="updateNow()">Update Now</button>
        <button class="update-later" onclick="dismissUpdate()">Later</button>
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="app-header">
            <h1>üìö 1000 Books Before Kindergarten</h1>
            <div class="child-selector">
                <select id="childSelect" onchange="switchChild(this.value)">
                    <option value="">Select Child</option>
                </select>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('dashboard', this)">üìä Dashboard</button>
            <button class="nav-tab" onclick="showPage('add-book', this)">‚ûï Add Book</button>
            <button class="nav-tab" onclick="showPage('suggestions', this)">üí° Suggestions</button>
            <button class="nav-tab" onclick="showPage('library', this)">üìö Library</button>
            <button class="nav-tab" onclick="showPage('badges', this)">üèÜ Badges</button>
            <button class="nav-tab" onclick="showPage('milestones', this)">üéØ Milestones</button>
            <button class="nav-tab" onclick="showPage('games', this)">üéÆ Games</button>
            <button class="nav-tab" onclick="showPage('settings', this)">‚öôÔ∏è Settings</button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="progress-container">
                    <svg class="progress-circle" viewBox="0 0 200 200">
                        <circle cx="100" cy="100" r="90" fill="none" stroke="#e9ecef" stroke-width="10"/>
                        <circle cx="100" cy="100" r="90" fill="none" stroke="#667eea" stroke-width="10"
                                stroke-dasharray="565" stroke-dashoffset="565" id="progressCircle"
                                transform="rotate(-90 100 100)"/>
                    </svg>
                    <div class="progress-text" id="bookCount">0</div>
                    <div class="progress-label">books read</div>
                </div>

                <div class="milestone-tracker" id="milestoneTracker" style="display: none;">
                    <div class="milestone-title">üéâ Next Milestone</div>
                    <div class="milestone-progress" id="milestoneProgress"></div>
                    <div class="next-milestone" id="nextMilestone"></div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-emoji">üìÖ</div>
                        <div class="stat-value" id="daysActive">0</div>
                        <div class="stat-label">Days Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-emoji">üìñ</div>
                        <div class="stat-value" id="thisWeek">0</div>
                        <div class="stat-label">This Week</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-emoji">‚≠ê</div>
                        <div class="stat-value" id="favorites">0</div>
                        <div class="stat-label">Favorites</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-emoji">üî•</div>
                        <div class="stat-value" id="streak">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                </div>

                <div class="recent-books">
                    <h3>Recently Read</h3>
                    <div class="recent-books-list" id="recentBooks">
                        <p style="color: #6c757d;">No books added yet. Start your reading journey!</p>
                    </div>
                </div>
            </div>

            <!-- Add Book Page -->
            <div id="add-book" class="page">
                <h2>Add a New Book</h2>
                <form id="addBookForm" onsubmit="addBook(event)">
                    <div class="form-group">
                        <label for="bookTitle">Book Title *</label>
                        <input type="text" id="bookTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="bookAuthor">Author</label>
                        <input type="text" id="bookAuthor">
                    </div>
                    <div class="form-group">
                        <label for="readDate">Date Read *</label>
                        <input type="date" id="readDate" required>
                    </div>
                    <div class="form-group">
                        <label>How did you like it?</label>
                        <div class="rating-buttons">
                            <button type="button" class="rating-btn" onclick="selectRating(this, 'love')">üòç Loved it!</button>
                            <button type="button" class="rating-btn" onclick="selectRating(this, 'like')">üòä Liked it</button>
                            <button type="button" class="rating-btn" onclick="selectRating(this, 'okay')">üòê It was okay</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">Notes (optional)</label>
                        <textarea id="notes" rows="3" placeholder="What did you think about this book?"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="isFavorite">
                            Add to favorites ‚≠ê
                        </label>
                    </div>
                    <button type="submit" class="submit-btn">Add Book üìö</button>
                </form>
            </div>

            <!-- Suggestions Page -->
            <div id="suggestions" class="page">
                <h2>Book Suggestions</h2>
                <div class="form-group">
                    <select id="categoryFilter" onchange="filterSuggestions()">
                        <option value="all">All Categories</option>
                        <option value="classic">Classic Picture Books</option>
                        <option value="bedtime">Bedtime Stories</option>
                        <option value="learning">Early Learning</option>
                        <option value="adventure">Adventure</option>
                        <option value="animals">Animal Stories</option>
                        <option value="rhymes">Nursery Rhymes</option>
                        <option value="seasonal">Seasonal & Holiday</option>
                    </select>
                </div>
                <div class="suggestion-lists" id="suggestionLists"></div>
            </div>

            <!-- Library Page -->
            <div id="library" class="page">
                <h2>Your Library</h2>
                <div class="form-group">
                    <input type="search" id="searchBooks" placeholder="Search books..." oninput="searchBooks()">
                </div>
                <div class="library-grid" id="libraryGrid">
                    <p style="color: #6c757d; text-align: center; grid-column: 1/-1;">Your library is empty. Start adding books!</p>
                </div>
            </div>

            <!-- Badges Page -->
            <div id="badges" class="page">
                <h2>Your Badges</h2>
                <div class="badges-grid" id="badgesGrid"></div>
            </div>

            <!-- Milestones Page -->
            <div id="milestones" class="page">
                <h2>Reading Milestones</h2>
                <div class="badges-grid" id="milestonesGrid"></div>
            </div>

            <!-- Games Page -->
            <div id="games" class="page">
                <h2>Reading Games</h2>
                <div class="games-intro">
                    <p>Complete reading challenges to unlock fun games!</p>
                </div>
                <div class="games-grid" id="gamesGrid"></div>

                <!-- Find the Bone Game -->
                <div id="findBoneGame" class="mini-game" style="display: none;">
                    <div class="game-header">
                        <h3>üêï Find the Bone!</h3>
                        <button class="game-close-btn" onclick="closeGame('findBone')">‚úï</button>
                    </div>
                    <div class="game-instructions">
                        <p>Help Clifford find his hidden bone! Click on the hiding spots.</p>
                    </div>
                    <div class="game-score">
                        Score: <span id="boneGameScore">0</span> | Attempts: <span id="boneGameAttempts">0</span>
                    </div>
                    <div class="bone-game-board" id="boneGameBoard"></div>
                    <button class="game-reset-btn" onclick="resetBoneGame()">Play Again</button>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <h2>Settings</h2>
                <div class="form-group">
                    <label for="childName">Child's Name</label>
                    <input type="text" id="childName" placeholder="Enter child's name">
                </div>
                <div class="form-group">
                    <label for="birthDate">Birth Date</label>
                    <input type="date" id="birthDate">
                </div>
                <div class="form-group">
                    <label for="dailyGoal">Daily Reading Goal</label>
                    <select id="dailyGoal">
                        <option value="1">1 book</option>
                        <option value="2">2 books</option>
                        <option value="3" selected>3 books</option>
                        <option value="4">4 books</option>
                        <option value="5">5 books</option>
                    </select>
                </div>
                <button class="submit-btn" onclick="saveSettings()">Save Settings</button>
                <div style="margin-top: 20px;">
                    <button class="submit-btn" style="background: #28a745;" onclick="exportData()">Export Data üì•</button>
                    <button class="submit-btn" style="background: #dc3545;" onclick="clearData()">Clear All Data üóëÔ∏è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // App Version - UPDATE THIS WHEN YOU MAKE CHANGES!
        const APP_VERSION = '1.0.1';

        // App State
        let appData = {
            children: [],
            currentChild: null,
            books: [],
            settings: {
                dailyGoal: 3
            }
        };

        let selectedRating = '';
        let currentGame = null;
        let boneGameData = {
            score: 0,
            attempts: 0,
            bonePosition: -1,
            revealed: []
        };
        let testMode = false;

        // Book Suggestions Database
        const bookSuggestions = {
            classic: {
                name: "Classic Picture Books",
                emoji: "üìñ",
                books: [
                    { title: "The Very Hungry Caterpillar", author: "Eric Carle", age: "2-5" },
                    { title: "Where the Wild Things Are", author: "Maurice Sendak", age: "3-6" },
                    { title: "Goodnight Moon", author: "Margaret Wise Brown", age: "0-3" },
                    { title: "The Cat in the Hat", author: "Dr. Seuss", age: "3-7" },
                    { title: "Corduroy", author: "Don Freeman", age: "3-5" },
                    { title: "Curious George", author: "H.A. Rey", age: "3-6" },
                    { title: "The Rainbow Fish", author: "Marcus Pfister", age: "3-6" },
                    { title: "Brown Bear, Brown Bear, What Do You See?", author: "Bill Martin Jr.", age: "0-3" },
                    { title: "Madeline", author: "Ludwig Bemelmans", age: "3-6" },
                    { title: "The Little House", author: "Virginia Lee Burton", age: "3-6" }
                ]
            },
            bedtime: {
                name: "Bedtime Stories",
                emoji: "üåô",
                books: [
                    { title: "The Going to Bed Book", author: "Sandra Boynton", age: "0-3" },
                    { title: "Llama Llama Red Pajama", author: "Anna Dewdney", age: "2-5" },
                    { title: "The Napping House", author: "Audrey Wood", age: "2-5" },
                    { title: "Time for Bed", author: "Mem Fox", age: "0-3" },
                    { title: "Guess How Much I Love You", author: "Sam McBratney", age: "2-5" },
                    { title: "Pajama Time!", author: "Sandra Boynton", age: "0-3" },
                    { title: "The Sleepy Little Alphabet", author: "Judy Sierra", age: "3-6" },
                    { title: "I Love You to the Moon and Back", author: "Amelia Hepworth", age: "2-5" },
                    { title: "The Rabbit Listened", author: "Cori Doerrfeld", age: "3-6" },
                    { title: "Dream Animals", author: "Emily Winfield Martin", age: "0-3" }
                ]
            },
            learning: {
                name: "Early Learning",
                emoji: "üî§",
                books: [
                    { title: "Chicka Chicka Boom Boom", author: "Bill Martin Jr.", age: "2-5" },
                    { title: "The Alphabet Book", author: "P.D. Eastman", age: "2-5" },
                    { title: "Counting Kisses", author: "Karen Katz", age: "0-3" },
                    { title: "Mouse Paint", author: "Ellen Stoll Walsh", age: "2-5" },
                    { title: "Ten Little Fingers and Ten Little Toes", author: "Mem Fox", age: "0-3" },
                    { title: "1, 2, 3 to the Zoo", author: "Eric Carle", age: "2-5" },
                    { title: "Color Zoo", author: "Lois Ehlert", age: "2-5" },
                    { title: "Freight Train", author: "Donald Crews", age: "2-4" },
                    { title: "My First Counting Book", author: "Lilian Moore", age: "2-5" },
                    { title: "Shapes, Shapes, Shapes", author: "Tana Hoban", age: "2-5" }
                ]
            },
            adventure: {
                name: "Adventure Stories",
                emoji: "üöÄ",
                books: [
                    { title: "We're Going on a Bear Hunt", author: "Michael Rosen", age: "3-6" },
                    { title: "The Little Engine That Could", author: "Watty Piper", age: "3-6" },
                    { title: "Harold and the Purple Crayon", author: "Crockett Johnson", age: "3-6" },
                    { title: "Oh, the Places You'll Go!", author: "Dr. Seuss", age: "3-7" },
                    { title: "The Adventures of Beekle", author: "Dan Santat", age: "3-6" },
                    { title: "Not a Box", author: "Antoinette Portis", age: "2-5" },
                    { title: "Journey", author: "Aaron Becker", age: "4-7" },
                    { title: "Where the Sidewalk Ends", author: "Shel Silverstein", age: "4-7" },
                    { title: "The Snail and the Whale", author: "Julia Donaldson", age: "3-6" },
                    { title: "Rosie's Walk", author: "Pat Hutchins", age: "2-5" }
                ]
            },
            animals: {
                name: "Animal Stories",
                emoji: "üêª",
                books: [
                    { title: "The Tale of Peter Rabbit", author: "Beatrix Potter", age: "3-6" },
                    { title: "If You Give a Mouse a Cookie", author: "Laura Numeroff", age: "2-5" },
                    { title: "Giraffes Can't Dance", author: "Giles Andreae", age: "3-6" },
                    { title: "The Gruffalo", author: "Julia Donaldson", age: "3-6" },
                    { title: "Dear Zoo", author: "Rod Campbell", age: "0-3" },
                    { title: "Polar Bear, Polar Bear, What Do You Hear?", author: "Bill Martin Jr.", age: "2-5" },
                    { title: "Click, Clack, Moo: Cows That Type", author: "Doreen Cronin", age: "3-6" },
                    { title: "The Lion and the Mouse", author: "Jerry Pinkney", age: "3-6" },
                    { title: "Are You My Mother?", author: "P.D. Eastman", age: "2-5" },
                    { title: "Put Me in the Zoo", author: "Robert Lopshire", age: "2-5" }
                ]
            },
            rhymes: {
                name: "Nursery Rhymes",
                emoji: "üéµ",
                books: [
                    { title: "Mother Goose's Nursery Rhymes", author: "Various", age: "0-5" },
                    { title: "The Real Mother Goose", author: "Blanche Fisher Wright", age: "0-5" },
                    { title: "Mary Engelbreit's Mother Goose", author: "Mary Engelbreit", age: "0-5" },
                    { title: "Tomie dePaola's Mother Goose", author: "Tomie dePaola", age: "0-5" },
                    { title: "Richard Scarry's Best Mother Goose Ever", author: "Richard Scarry", age: "0-5" },
                    { title: "Each Peach Pear Plum", author: "Janet & Allan Ahlberg", age: "0-3" },
                    { title: "Hickory Dickory Dock", author: "Keith Baker", age: "0-3" },
                    { title: "Hey Diddle Diddle", author: "Salley Mavor", age: "0-3" },
                    { title: "Pat-a-Cake", author: "Mary Brigid Barrett", age: "0-3" },
                    { title: "This Little Piggy", author: "Jane Yolen", age: "0-3" }
                ]
            },
            seasonal: {
                name: "Seasonal & Holiday",
                emoji: "üéÉ",
                books: [
                    { title: "The Snowy Day", author: "Ezra Jack Keats", age: "2-5" },
                    { title: "The Polar Express", author: "Chris Van Allsburg", age: "3-7" },
                    { title: "Room on the Broom", author: "Julia Donaldson", age: "3-6" },
                    { title: "The Pumpkin Book", author: "Gail Gibbons", age: "3-6" },
                    { title: "The Mitten", author: "Jan Brett", age: "3-6" },
                    { title: "How the Grinch Stole Christmas", author: "Dr. Seuss", age: "3-7" },
                    { title: "The Runaway Bunny", author: "Margaret Wise Brown", age: "2-5" },
                    { title: "Leaf Man", author: "Lois Ehlert", age: "3-6" },
                    { title: "The Night Before Christmas", author: "Clement C. Moore", age: "3-7" },
                    { title: "It's the Great Pumpkin, Charlie Brown", author: "Charles M. Schulz", age: "3-7" }
                ]
            }
        };

        // Milestones
        const milestones = [
            { books: 10, name: "First Chapter", emoji: "üìñ" },
            { books: 25, name: "Bookworm", emoji: "üêõ" },
            { books: 50, name: "Page Turner", emoji: "üìÑ" },
            { books: 100, name: "Century Reader", emoji: "üíØ" },
            { books: 250, name: "Quarter Master", emoji: "üéØ" },
            { books: 500, name: "Halfway Hero", emoji: "üåü" },
            { books: 750, name: "Super Reader", emoji: "ü¶∏" },
            { books: 1000, name: "Champion!", emoji: "üèÜ" }
        ];

        // Badges
        const badges = [
            // Getting Started
            { id: 'first-book', name: 'First Book', description: 'Read your first book!', emoji: 'üìò', condition: (books) => books.length >= 1 },
            { id: 'first-five', name: 'High Five', description: 'Read 5 books', emoji: '‚úã', condition: (books) => books.length >= 5 },
            { id: 'double-digits', name: 'Double Digits', description: 'Read 10 books', emoji: 'üîü', condition: (books) => books.length >= 10 },

            // Streaks & Consistency
            { id: 'week-streak', name: 'Week Streak', description: '7 day reading streak', emoji: 'üî•', condition: (books) => calculateStreak(books) >= 7 },
            { id: 'fortnight-streak', name: 'Two Week Wonder', description: '14 day reading streak', emoji: 'üí´', condition: (books) => calculateStreak(books) >= 14 },
            { id: 'month-streak', name: 'Monthly Master', description: '30 day reading streak', emoji: 'üèÖ', condition: (books) => calculateStreak(books) >= 30 },
            { id: 'weekend-warrior', name: 'Weekend Warrior', description: 'Read on 5 consecutive weekends', emoji: 'ü¶∏', condition: (books) => checkWeekendStreak(books) >= 5 },

            // Reading Patterns
            { id: 'night-owl', name: 'Night Owl', description: 'Read 10 bedtime stories', emoji: 'ü¶â', condition: (books) => books.filter(b => b.notes && b.notes.toLowerCase().includes('bedtime')).length >= 10 },
            { id: 'early-bird', name: 'Early Bird', description: 'Read 10 books before noon (add "morning" to notes)', emoji: 'üê¶', condition: (books) => books.filter(b => b.notes && b.notes.toLowerCase().includes('morning')).length >= 10 },
            { id: 'story-time', name: 'Story Time Pro', description: 'Read at library story time 5 times (add "story time" to notes)', emoji: 'üé≠', condition: (books) => books.filter(b => b.notes && b.notes.toLowerCase().includes('story time')).length >= 5 },

            // Favorites & Ratings
            { id: 'favorite-finder', name: 'Favorite Finder', description: 'Mark 5 books as favorites', emoji: '‚≠ê', condition: (books) => books.filter(b => b.isFavorite).length >= 5 },
            { id: 'super-fan', name: 'Super Fan', description: 'Mark 20 books as favorites', emoji: 'üåü', condition: (books) => books.filter(b => b.isFavorite).length >= 20 },
            { id: 'love-reader', name: 'Book Lover', description: 'Rate 10 books as "Loved it!"', emoji: 'üíñ', condition: (books) => books.filter(b => b.rating === 'love').length >= 10 },
            { id: 'critic', name: 'Little Critic', description: 'Rate 25 books with any rating', emoji: 'üéì', condition: (books) => books.filter(b => b.rating).length >= 25 },

            // Speed & Volume
            { id: 'speed-reader', name: 'Speed Reader', description: 'Read 10 books in one week', emoji: '‚ö°', condition: (books) => checkWeeklyBooks(books) >= 10 },
            { id: 'marathon-reader', name: 'Marathon Reader', description: 'Read 5 books in one day', emoji: 'üèÉ', condition: (books) => checkDailyMax(books) >= 5 },
            { id: 'century-club', name: 'Century Club', description: 'Read 100 books total', emoji: 'üíØ', condition: (books) => books.length >= 100 },

            // Variety
            { id: 'variety-reader', name: 'Variety Reader', description: 'Read books from 10 different authors', emoji: 'üåà', condition: (books) => new Set(books.map(b => b.author).filter(a => a)).size >= 10 },
            { id: 'author-fan', name: 'Author Fan', description: 'Read 5 books by the same author', emoji: '‚úçÔ∏è', condition: (books) => checkSameAuthor(books) >= 5 },
            { id: 'series-starter', name: 'Series Starter', description: 'Read 3 books from same series (add series name to notes)', emoji: 'üìö', condition: (books) => checkSeries(books) >= 3 },

            // Special Achievements
            { id: 'holiday-reader', name: 'Holiday Reader', description: 'Read holiday books (add "holiday" to notes)', emoji: 'üéÑ', condition: (books) => books.filter(b => b.notes && b.notes.toLowerCase().includes('holiday')).length >= 5 },
            { id: 'summer-reader', name: 'Summer Reader', description: 'Read 30 books in June, July, or August', emoji: '‚òÄÔ∏è', condition: (books) => checkSummerReading(books) >= 30 },
            { id: 'rainy-day', name: 'Rainy Day Reader', description: 'Read on a rainy day (add "rainy day" to notes)', emoji: 'üåßÔ∏è', condition: (books) => books.filter(b => b.notes && b.notes.toLowerCase().includes('rainy day')).length >= 3 },
            { id: 'library-lover', name: 'Library Lover', description: 'Read 20 library books (add "library book" to notes)', emoji: 'üèõÔ∏è', condition: (books) => books.filter(b => b.notes && b.notes.toLowerCase().includes('library book')).length >= 20 },
            { id: 'rereader', name: 'Repeat Reader', description: 'Read the same book 3 times', emoji: 'üîÑ', condition: (books) => checkRereads(books) >= 3 },
            { id: 'note-taker', name: 'Note Taker', description: 'Add notes to 15 books', emoji: 'üìù', condition: (books) => books.filter(b => b.notes && b.notes.length > 10).length >= 15 }
        ];

        // Initialize App
        function initApp() {
            loadData();
            updateChildSelector();
            setTodaysDate();
            updateDashboard();
            initializeBadges();
            initializeMilestones();
            checkForUpdates();
            registerServiceWorker();
        }

        // Register Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('Service Worker registered');

                    // Listen for updates from service worker
                    navigator.serviceWorker.addEventListener('message', event => {
                        if (event.data && event.data.type === 'UPDATE_AVAILABLE') {
                            showUpdateBanner(event.data.version);
                        }
                    });

                    // Check for updates periodically (every 30 minutes)
                    setInterval(() => {
                        registration.update();
                    }, 30 * 60 * 1000);
                }).catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            }
        }

        // Check for Updates
        function checkForUpdates() {
            const lastVersion = localStorage.getItem('appVersion');

            if (lastVersion && lastVersion !== APP_VERSION) {
                // User has an older version, show what's new
                showToast(`Updated to version ${APP_VERSION}! üéâ`);
            }

            // Save current version
            localStorage.setItem('appVersion', APP_VERSION);
        }

        // Show Update Banner
        function showUpdateBanner(newVersion) {
            const banner = document.getElementById('updateBanner');
            banner.classList.add('show');

            // Also save that an update is available
            localStorage.setItem('updateAvailable', 'true');
        }

        // Update Now
        function updateNow() {
            // Clear cache and reload
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
            location.reload(true);
        }

        // Dismiss Update
        function dismissUpdate() {
            const banner = document.getElementById('updateBanner');
            banner.classList.remove('show');

            // Show reminder in 1 hour
            setTimeout(() => {
                if (localStorage.getItem('updateAvailable') === 'true') {
                    showUpdateBanner();
                }
            }, 60 * 60 * 1000);
        }

        // Load Data
        function loadData() {
            const saved = localStorage.getItem('1000BooksApp');
            if (saved) {
                appData = JSON.parse(saved);
            }
        }

        // Save Data
        function saveData() {
            localStorage.setItem('1000BooksApp', JSON.stringify(appData));
        }

        // Update Child Selector
        function updateChildSelector() {
            const selector = document.getElementById('childSelect');
            selector.innerHTML = '<option value="">Select Child</option>';

            appData.children.forEach((child, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = child.name;
                selector.appendChild(option);
            });

            // Add option to create new child
            const addOption = document.createElement('option');
            addOption.value = 'new';
            addOption.textContent = '‚ûï Add New Child';
            selector.appendChild(addOption);
        }

        // Switch Child
        function switchChild(value) {
            if (value === 'new') {
                const name = prompt('Enter child\'s name:');
                if (name) {
                    const newChild = {
                        id: Date.now(),
                        name: name,
                        birthDate: '',
                        books: []
                    };
                    appData.children.push(newChild);
                    appData.currentChild = appData.children.length - 1;
                    saveData();
                    updateChildSelector();
                    document.getElementById('childSelect').value = appData.currentChild;
                    updateDashboard();
                }
            } else if (value !== '') {
                appData.currentChild = parseInt(value);
                saveData();
                updateDashboard();
            }
        }

        // Show Page
        function showPage(pageName, buttonElement) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageName).classList.add('active');

            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }

            if (pageName === 'library') {
                displayLibrary();
            } else if (pageName === 'suggestions') {
                displaySuggestions();
            } else if (pageName === 'games') {
                displayGames();
            }
        }

        // Update Dashboard
        function updateDashboard() {
            if (appData.currentChild === null || !appData.children[appData.currentChild]) {
                document.getElementById('bookCount').textContent = '0';
                return;
            }

            const child = appData.children[appData.currentChild];
            const books = child.books || [];

            // Update book count
            document.getElementById('bookCount').textContent = books.length;

            // Update progress circle
            const progress = (books.length / 1000) * 565;
            document.getElementById('progressCircle').style.strokeDashoffset = 565 - progress;

            // Update stats
            document.getElementById('daysActive').textContent = calculateDaysActive(books);
            document.getElementById('thisWeek').textContent = calculateThisWeek(books);
            document.getElementById('favorites').textContent = books.filter(b => b.isFavorite).length;
            document.getElementById('streak').textContent = calculateStreak(books);

            // Update recent books
            displayRecentBooks(books);

            // Update milestone tracker
            updateMilestoneTracker(books.length);
        }

        // Update Milestone Tracker
        function updateMilestoneTracker(bookCount) {
            const tracker = document.getElementById('milestoneTracker');
            const nextMilestone = milestones.find(m => m.books > bookCount);

            if (nextMilestone) {
                tracker.style.display = 'block';
                document.getElementById('milestoneProgress').textContent = `${bookCount} / ${nextMilestone.books} books`;
                document.getElementById('nextMilestone').textContent = `${nextMilestone.emoji} ${nextMilestone.name}`;
            } else {
                tracker.style.display = 'none';
            }
        }

        // Calculate Days Active
        function calculateDaysActive(books) {
            if (books.length === 0) return 0;
            const dates = [...new Set(books.map(b => b.readDate))];
            return dates.length;
        }

        // Calculate This Week
        function calculateThisWeek(books) {
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            return books.filter(b => new Date(b.readDate) >= weekAgo).length;
        }

        // Check Weekly Books
        function checkWeeklyBooks(books) {
            let maxWeekly = 0;
            const sortedBooks = books.sort((a, b) => new Date(a.readDate) - new Date(b.readDate));

            for (let i = 0; i < sortedBooks.length; i++) {
                const weekEnd = new Date(sortedBooks[i].readDate);
                weekEnd.setDate(weekEnd.getDate() + 7);
                const weekBooks = sortedBooks.filter(b =>
                    new Date(b.readDate) >= new Date(sortedBooks[i].readDate) &&
                    new Date(b.readDate) < weekEnd
                ).length;
                maxWeekly = Math.max(maxWeekly, weekBooks);
            }
            return maxWeekly;
        }

        // Calculate Streak
        function calculateStreak(books) {
            if (books.length === 0) return 0;

            const dates = [...new Set(books.map(b => b.readDate))].sort().reverse();
            const today = new Date().toISOString().split('T')[0];

            if (dates[0] !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                if (dates[0] !== yesterday.toISOString().split('T')[0]) {
                    return 0;
                }
            }

            let streak = 1;
            for (let i = 1; i < dates.length; i++) {
                const prevDate = new Date(dates[i - 1]);
                const currDate = new Date(dates[i]);
                const dayDiff = (prevDate - currDate) / (1000 * 60 * 60 * 24);

                if (dayDiff === 1) {
                    streak++;
                } else {
                    break;
                }
            }

            return streak;
        }

        // Check Weekend Streak
        function checkWeekendStreak(books) {
            if (books.length === 0) return 0;

            const weekendDates = books
                .filter(b => {
                    const date = new Date(b.readDate);
                    const day = date.getDay();
                    return day === 0 || day === 6; // Sunday or Saturday
                })
                .map(b => b.readDate);

            if (weekendDates.length === 0) return 0;

            // Group by weekend
            const weekends = new Set();
            weekendDates.forEach(dateStr => {
                const date = new Date(dateStr);
                const weekStart = new Date(date);
                if (date.getDay() === 0) { // Sunday
                    weekStart.setDate(date.getDate() - 1);
                }
                while (weekStart.getDay() !== 6) { // Find Saturday
                    weekStart.setDate(weekStart.getDate() - 1);
                }
                weekends.add(weekStart.toISOString().split('T')[0]);
            });

            // Check for consecutive weekends
            const sortedWeekends = Array.from(weekends).sort().reverse();
            let maxStreak = 1;
            let currentStreak = 1;

            for (let i = 1; i < sortedWeekends.length; i++) {
                const prevWeekend = new Date(sortedWeekends[i - 1]);
                const currWeekend = new Date(sortedWeekends[i]);
                const dayDiff = (prevWeekend - currWeekend) / (1000 * 60 * 60 * 24);

                if (dayDiff === 7) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 1;
                }
            }

            return maxStreak;
        }

        // Check Daily Maximum
        function checkDailyMax(books) {
            if (books.length === 0) return 0;

            const booksByDate = {};
            books.forEach(book => {
                if (!booksByDate[book.readDate]) {
                    booksByDate[book.readDate] = 0;
                }
                booksByDate[book.readDate]++;
            });

            return Math.max(...Object.values(booksByDate));
        }

        // Check Same Author
        function checkSameAuthor(books) {
            if (books.length === 0) return 0;

            const authorCounts = {};
            books.forEach(book => {
                if (book.author) {
                    if (!authorCounts[book.author]) {
                        authorCounts[book.author] = 0;
                    }
                    authorCounts[book.author]++;
                }
            });

            return Math.max(...Object.values(authorCounts), 0);
        }

        // Check Series
        function checkSeries(books) {
            if (books.length === 0) return 0;

            const seriesBooks = books.filter(b => b.notes &&
                (b.notes.toLowerCase().includes('series') ||
                 b.notes.toLowerCase().includes('book 1') ||
                 b.notes.toLowerCase().includes('book 2') ||
                 b.notes.toLowerCase().includes('book 3')));

            // Try to identify series by matching titles
            const titleGroups = {};
            seriesBooks.forEach(book => {
                const baseTitle = book.title.replace(/[:#]\s*book\s*\d+/i, '').trim();
                if (!titleGroups[baseTitle]) {
                    titleGroups[baseTitle] = 0;
                }
                titleGroups[baseTitle]++;
            });

            return Math.max(...Object.values(titleGroups), seriesBooks.length >= 3 ? 3 : 0);
        }

        // Check Summer Reading
        function checkSummerReading(books) {
            if (books.length === 0) return 0;

            return books.filter(book => {
                const date = new Date(book.readDate);
                const month = date.getMonth();
                return month >= 5 && month <= 7; // June (5), July (6), August (7)
            }).length;
        }

        // Check Rereads
        function checkRereads(books) {
            if (books.length === 0) return 0;

            const titleCounts = {};
            books.forEach(book => {
                const title = book.title.toLowerCase();
                if (!titleCounts[title]) {
                    titleCounts[title] = 0;
                }
                titleCounts[title]++;
            });

            return Math.max(...Object.values(titleCounts), 0);
        }

        // Display Recent Books
        function displayRecentBooks(books) {
            const container = document.getElementById('recentBooks');
            if (books.length === 0) {
                container.innerHTML = '<p style="color: #6c757d;">No books added yet. Start your reading journey!</p>';
                return;
            }

            const recent = books.slice(-5).reverse();
            container.innerHTML = recent.map(book => `
                <div class="recent-book">
                    <div style="font-weight: bold; margin-bottom: 5px;">${book.title}</div>
                    <div style="font-size: 0.9rem; color: #6c757d;">${book.rating === 'love' ? 'üòç' : book.rating === 'like' ? 'üòä' : 'üòê'}</div>
                </div>
            `).join('');
        }

        // Set Today's Date
        function setTodaysDate() {
            document.getElementById('readDate').value = new Date().toISOString().split('T')[0];
        }

        // Select Rating
        function selectRating(btn, rating) {
            document.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedRating = rating;
        }

        // Add Book
        function addBook(event) {
            event.preventDefault();

            if (appData.currentChild === null) {
                showToast('Please select or add a child first!');
                document.getElementById('childSelect').focus();
                return;
            }

            const book = {
                id: Date.now(),
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                readDate: document.getElementById('readDate').value,
                rating: selectedRating,
                notes: document.getElementById('notes').value,
                isFavorite: document.getElementById('isFavorite').checked
            };

            appData.children[appData.currentChild].books.push(book);
            saveData();

            // Check for new badges
            checkBadges();

            // Reset form
            document.getElementById('addBookForm').reset();
            setTodaysDate();
            selectedRating = '';
            document.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('selected'));

            showToast('Book added successfully! üìö');
            updateDashboard();

            // Check for milestones
            const bookCount = appData.children[appData.currentChild].books.length;
            const milestone = milestones.find(m => m.books === bookCount);
            if (milestone) {
                setTimeout(() => {
                    showToast(`üéâ Milestone reached: ${milestone.name}! ${milestone.emoji}`);
                }, 1000);
            }
        }

        // Display Library
        function displayLibrary() {
            if (appData.currentChild === null || !appData.children[appData.currentChild]) {
                document.getElementById('libraryGrid').innerHTML = '<p style="color: #6c757d; text-align: center; grid-column: 1/-1;">Please select a child first.</p>';
                return;
            }

            const books = appData.children[appData.currentChild].books || [];
            const container = document.getElementById('libraryGrid');

            if (books.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center; grid-column: 1/-1;">Your library is empty. Start adding books!</p>';
                return;
            }

            container.innerHTML = books.map(book => `
                <div class="book-card">
                    <div class="book-title">${book.title} ${book.isFavorite ? '‚≠ê' : ''}</div>
                    ${book.author ? `<div class="book-author">by ${book.author}</div>` : ''}
                    <div class="book-date">Read on ${new Date(book.readDate).toLocaleDateString()}</div>
                    <div class="book-rating">${book.rating === 'love' ? 'üòç Loved it!' : book.rating === 'like' ? 'üòä Liked it' : book.rating === 'okay' ? 'üòê It was okay' : ''}</div>
                    ${book.notes ? `<div style="margin-top: 10px; font-size: 0.9rem; color: #6c757d;">${book.notes}</div>` : ''}
                </div>
            `).join('');
        }

        // Search Books
        function searchBooks() {
            const query = document.getElementById('searchBooks').value.toLowerCase();
            const books = appData.children[appData.currentChild]?.books || [];

            const filtered = books.filter(book =>
                book.title.toLowerCase().includes(query) ||
                book.author.toLowerCase().includes(query)
            );

            const container = document.getElementById('libraryGrid');
            if (filtered.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center; grid-column: 1/-1;">No books found.</p>';
                return;
            }

            container.innerHTML = filtered.map(book => `
                <div class="book-card">
                    <div class="book-title">${book.title} ${book.isFavorite ? '‚≠ê' : ''}</div>
                    ${book.author ? `<div class="book-author">by ${book.author}</div>` : ''}
                    <div class="book-date">Read on ${new Date(book.readDate).toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        // Initialize Badges
        function initializeBadges() {
            const container = document.getElementById('badgesGrid');
            container.innerHTML = badges.map(badge => `
                <div class="badge-card locked" id="badge-${badge.id}">
                    <div class="badge-icon">${badge.emoji}</div>
                    <div class="badge-name">${badge.name}</div>
                    <div class="badge-description">${badge.description}</div>
                </div>
            `).join('');
        }

        // Check Badges
        function checkBadges() {
            if (appData.currentChild === null) return;

            const books = appData.children[appData.currentChild].books || [];

            badges.forEach(badge => {
                const element = document.getElementById(`badge-${badge.id}`);
                if (badge.condition(books)) {
                    element.classList.remove('locked');
                    element.classList.add('earned');
                } else {
                    element.classList.add('locked');
                    element.classList.remove('earned');
                }
            });
        }

        // Initialize Milestones
        function initializeMilestones() {
            const container = document.getElementById('milestonesGrid');
            container.innerHTML = milestones.map(milestone => `
                <div class="badge-card locked" id="milestone-${milestone.books}">
                    <div class="badge-icon">${milestone.emoji}</div>
                    <div class="badge-name">${milestone.name}</div>
                    <div class="badge-description">${milestone.books} books</div>
                </div>
            `).join('');

            updateMilestones();
        }

        // Update Milestones
        function updateMilestones() {
            if (appData.currentChild === null) return;

            const bookCount = appData.children[appData.currentChild]?.books?.length || 0;

            milestones.forEach(milestone => {
                const element = document.getElementById(`milestone-${milestone.books}`);
                if (bookCount >= milestone.books) {
                    element.classList.remove('locked');
                    element.classList.add('earned');
                } else {
                    element.classList.add('locked');
                    element.classList.remove('earned');
                }
            });
        }

        // Save Settings
        function saveSettings() {
            if (appData.currentChild === null) {
                showToast('Please select a child first!');
                return;
            }

            const child = appData.children[appData.currentChild];
            child.name = document.getElementById('childName').value || child.name;
            child.birthDate = document.getElementById('birthDate').value;
            appData.settings.dailyGoal = parseInt(document.getElementById('dailyGoal').value);

            saveData();
            updateChildSelector();
            showToast('Settings saved!');
        }

        // Export Data
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportName = `1000-books-backup-${new Date().toISOString().split('T')[0]}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportName);
            linkElement.click();

            showToast('Data exported successfully!');
        }

        // Clear Data
        function clearData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone!')) {
                if (confirm('Really sure? All your books and progress will be lost!')) {
                    localStorage.removeItem('1000BooksApp');
                    appData = {
                        children: [],
                        currentChild: null,
                        books: [],
                        settings: { dailyGoal: 3 }
                    };
                    initApp();
                    showToast('All data cleared');
                }
            }
        }

        // Show Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Display Suggestions
        function displaySuggestions() {
            const container = document.getElementById('suggestionLists');
            const filter = document.getElementById('categoryFilter').value;

            container.innerHTML = '';

            let categoryIndex = 0;
            for (const [key, category] of Object.entries(bookSuggestions)) {
                if (filter !== 'all' && filter !== key) continue;

                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'suggestion-category collapsed';
                categoryDiv.id = `category-${key}`;
                categoryDiv.innerHTML = `
                    <div class="suggestion-category-header" onclick="toggleCategory('${key}')">
                        <h3>${category.emoji} ${category.name}</h3>
                        <span class="expand-icon">‚ñº</span>
                    </div>
                    <div class="suggestion-category-content">
                        <div class="suggestion-books">
                            ${category.books.map((book, index) => `
                                <div class="suggestion-book">
                                    <div class="suggestion-book-info">
                                        <div class="suggestion-book-title">${book.title}</div>
                                        <div class="suggestion-book-author">by ${book.author}</div>
                                        <div class="suggestion-book-age">Ages ${book.age}</div>
                                    </div>
                                    <button class="add-suggestion-btn" id="suggest-${key}-${index}"
                                            onclick="addSuggestedBook('${key}', ${index})">
                                        Add Book
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(categoryDiv);
                categoryIndex++;
            }

            // Auto-expand first category
            const firstCategory = container.querySelector('.suggestion-category');
            if (firstCategory) {
                firstCategory.classList.remove('collapsed');
            }
        }

        // Toggle Category
        function toggleCategory(key) {
            const categoryDiv = document.getElementById(`category-${key}`);
            if (categoryDiv) {
                categoryDiv.classList.toggle('collapsed');
            }
        }

        // Filter Suggestions
        function filterSuggestions() {
            displaySuggestions();
        }

        // Add Suggested Book
        function addSuggestedBook(categoryKey, bookIndex) {
            if (appData.currentChild === null) {
                showToast('Please select or add a child first!');
                document.getElementById('childSelect').focus();
                return;
            }

            const book = bookSuggestions[categoryKey].books[bookIndex];
            const today = new Date().toISOString().split('T')[0];

            const newBook = {
                id: Date.now(),
                title: book.title,
                author: book.author,
                readDate: today,
                rating: '',
                notes: `Suggested for ages ${book.age}`,
                isFavorite: false
            };

            appData.children[appData.currentChild].books.push(newBook);
            saveData();

            // Update button to show it's been added
            const button = document.getElementById(`suggest-${categoryKey}-${bookIndex}`);
            button.textContent = '‚úì Added';
            button.classList.add('added');
            button.disabled = true;

            // Check for new badges
            checkBadges();
            updateDashboard();

            showToast(`Added "${book.title}" to your library! üìö`);

            // Check for milestones
            const bookCount = appData.children[appData.currentChild].books.length;
            const milestone = milestones.find(m => m.books === bookCount);
            if (milestone) {
                setTimeout(() => {
                    showToast(`üéâ Milestone reached: ${milestone.name}! ${milestone.emoji}`);
                }, 1000);
            }

            // Reset button after a delay
            setTimeout(() => {
                if (button) {
                    button.textContent = 'Add Book';
                    button.classList.remove('added');
                    button.disabled = false;
                }
            }, 3000);
        }

        // Display Games
        function displayGames() {
            const container = document.getElementById('gamesGrid');

            // Check if games should be unlocked
            const unlockedGames = checkUnlockedGames();

            const games = [
                {
                    id: 'findBone',
                    name: 'Find the Bone',
                    icon: 'ü¶¥',
                    requirement: 'Read all 10 Animal Stories',
                    unlocked: unlockedGames.findBone,
                    action: () => startBoneGame()
                },
                {
                    id: 'letterMatch',
                    name: 'Letter Match',
                    icon: 'üî§',
                    requirement: 'Read all 10 Early Learning books',
                    unlocked: unlockedGames.letterMatch,
                    action: () => showToast('Letter Match game coming soon!')
                },
                {
                    id: 'storyTime',
                    name: 'Story Builder',
                    icon: 'üìù',
                    requirement: 'Read all 10 Adventure Stories',
                    unlocked: unlockedGames.storyBuilder,
                    action: () => showToast('Story Builder game coming soon!')
                },
                {
                    id: 'seasonSort',
                    name: 'Season Sorter',
                    icon: 'üçÇ',
                    requirement: 'Read all 10 Seasonal books',
                    unlocked: unlockedGames.seasonSort,
                    action: () => showToast('Season Sorter game coming soon!')
                }
            ];

            container.innerHTML = games.map(game => `
                <div class="game-card ${game.unlocked ? 'unlocked' : 'locked'}"
                     onclick="${game.unlocked ? `gameActions['${game.id}']()` : 'showLockedMessage()'}">
                    <div class="game-icon">${game.icon}</div>
                    <div class="game-name">${game.name}</div>
                    <div class="game-requirement">
                        ${game.unlocked ? '‚úì Unlocked!' : `üîí ${game.requirement}`}
                    </div>
                </div>
            `).join('');

            // Store game actions globally
            window.gameActions = {
                findBone: () => startBoneGame(),
                letterMatch: () => showToast('Letter Match game coming soon!'),
                storyBuilder: () => showToast('Story Builder game coming soon!'),
                seasonSort: () => showToast('Season Sorter game coming soon!')
            };
        }

        // Check Unlocked Games
        function checkUnlockedGames() {
            // Test mode unlocks all games
            if (testMode) {
                return {
                    findBone: true,
                    letterMatch: true,
                    storyBuilder: true,
                    seasonSort: true
                };
            }

            if (appData.currentChild === null || !appData.children[appData.currentChild]) {
                return {
                    findBone: false,
                    letterMatch: false,
                    storyBuilder: false,
                    seasonSort: false
                };
            }

            const books = appData.children[appData.currentChild].books || [];

            // Check if user has read all books from each suggestion category
            const readTitles = new Set(books.map(b => b.title.toLowerCase()));

            const hasReadAllFromCategory = (category) => {
                let readCount = 0;
                bookSuggestions[category].books.forEach(book => {
                    if (readTitles.has(book.title.toLowerCase())) {
                        readCount++;
                    }
                });
                return readCount >= 10;
            };

            return {
                findBone: hasReadAllFromCategory('animals'),
                letterMatch: hasReadAllFromCategory('learning'),
                storyBuilder: hasReadAllFromCategory('adventure'),
                seasonSort: hasReadAllFromCategory('seasonal')
            };
        }

        // Show Locked Message
        function showLockedMessage() {
            showToast('Complete the reading challenge to unlock this game! üîí');
        }

        // Start Bone Game
        function startBoneGame() {
            const gameDiv = document.getElementById('findBoneGame');
            gameDiv.style.display = 'block';

            // Create overlay
            let overlay = document.getElementById('gameOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'gameOverlay';
                overlay.className = 'game-overlay';
                overlay.onclick = () => closeGame('findBone');
                document.body.appendChild(overlay);
            }
            overlay.style.display = 'block';

            resetBoneGame();
        }

        // Reset Bone Game
        function resetBoneGame() {
            boneGameData = {
                score: 0,
                attempts: 0,
                bonePosition: Math.floor(Math.random() * 16),
                revealed: []
            };

            const board = document.getElementById('boneGameBoard');
            board.innerHTML = '';

            for (let i = 0; i < 16; i++) {
                const spot = document.createElement('div');
                spot.className = 'hiding-spot';
                spot.innerHTML = '‚ùì';
                spot.onclick = () => checkSpot(i);
                board.appendChild(spot);
            }

            updateBoneGameScore();
        }

        // Check Spot in Bone Game
        function checkSpot(index) {
            if (boneGameData.revealed.includes(index)) return;

            boneGameData.attempts++;
            boneGameData.revealed.push(index);

            const spots = document.querySelectorAll('.hiding-spot');
            const spot = spots[index];

            if (index === boneGameData.bonePosition) {
                // Found the bone!
                spot.innerHTML = 'ü¶¥';
                spot.classList.add('found');
                boneGameData.score += Math.max(100 - (boneGameData.attempts - 1) * 10, 10);

                // Disable all spots
                spots.forEach(s => {
                    s.onclick = null;
                    if (!s.classList.contains('found')) {
                        s.classList.add('revealed');
                    }
                });

                setTimeout(() => {
                    showToast(`You found the bone! Score: ${boneGameData.score} üéâ`);
                }, 500);
            } else {
                // Not here
                spot.innerHTML = 'üå≥';
                spot.classList.add('revealed');
            }

            updateBoneGameScore();
        }

        // Update Bone Game Score
        function updateBoneGameScore() {
            document.getElementById('boneGameScore').textContent = boneGameData.score;
            document.getElementById('boneGameAttempts').textContent = boneGameData.attempts;
        }

        // Close Game
        function closeGame(gameId) {
            if (gameId === 'findBone') {
                document.getElementById('findBoneGame').style.display = 'none';
            }
            const overlay = document.getElementById('gameOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // Initialize app when page loads
        window.addEventListener('DOMContentLoaded', initApp);

        // Developer test mode - Press Ctrl+Shift+G to toggle test mode (G for Games)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'G') {
                e.preventDefault(); // Prevent any browser default action
                testMode = !testMode;
                if (testMode) {
                    showToast('üéÆ Test Mode ENABLED - All games unlocked!');
                } else {
                    showToast('Test Mode disabled');
                }

                // Refresh games page if currently viewing it
                const gamesPage = document.getElementById('games');
                if (gamesPage && gamesPage.classList.contains('active')) {
                    displayGames();
                }
            }
        });
    </script>
</body>
</html>